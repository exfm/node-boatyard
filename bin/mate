#!/usr/bin/env node

"use strict";

var yard = require('../'),
    Mate = yard.Mate,
    Hand = yard.Hand,
    os = require('os'),
    hostname = os.hostname(),
    cluster = require('cluster'),
    util = require('util'),
    winston = require('winston');

var log = winston.loggers.get('shipyard');

var captainHost = 'localhost',
    numHands = os.cpus().length,
    task = require('../examples/task.js');


if (cluster.isMaster){
    new Mate(hostname, captainHost, numHands).allHandsOnDeck();
}
else {
    new Hand(hostname).getToWork(function(msg){
        log.silly('Working on partition ', msg);
        task.apply(this, [msg.partition]);
    });
}